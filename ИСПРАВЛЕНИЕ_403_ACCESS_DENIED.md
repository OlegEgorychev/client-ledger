# Исправление ошибки 403: access_denied

## Проблема

При попытке войти в Google Drive через приложение появляется ошибка:
```
403: access_denied
```

Это происходит потому, что OAuth Consent Screen находится в режиме тестирования, и ваш Google аккаунт не добавлен в список тестовых пользователей.

## Решение

### Вариант 1: Добавить себя в тестовых пользователей (рекомендуется для разработки)

1. **Откройте Google Cloud Console:**
   - Перейдите на https://console.cloud.google.com/
   - Убедитесь, что выбран правильный проект

2. **Откройте OAuth Consent Screen:**
   - В боковом меню выберите **"APIs & Services" → "OAuth consent screen"**

3. **Добавьте тестовых пользователей:**
   - Прокрутите вниз до раздела **"Test users"**
   - Нажмите кнопку **"+ ADD USERS"**
   - Введите ваш email: **egorychevoleg92@gmail.com**
   - Нажмите **"ADD"**
   - Нажмите **"SAVE"** внизу страницы

4. **Повторите попытку входа:**
   - Закройте приложение полностью
   - Откройте приложение снова
   - Перейдите в Настройки → Резервное копирование
   - Нажмите "Войти в Google Drive"
   - Теперь вход должен пройти успешно

---

### Вариант 2: Опубликовать приложение (для production)

⚠️ **Внимание:** Публикация приложения требует прохождения проверки Google, если вы запрашиваете чувствительные области (scopes). Для личного использования лучше использовать Вариант 1.

Если все же хотите опубликовать:

1. **Откройте OAuth Consent Screen:**
   - Перейдите на https://console.cloud.google.com/
   - **"APIs & Services" → "OAuth consent screen"**

2. **Проверьте настройки:**
   - Убедитесь, что все обязательные поля заполнены
   - Проверьте, что указаны правильные scopes (email, profile, drive.file)

3. **Отправьте на проверку:**
   - Нажмите **"PUBLISH APP"** вверху страницы
   - Заполните форму проверки (может потребоваться несколько дней)
   - После одобрения приложение будет доступно всем пользователям

---

## Важно

### Режим тестирования

- ✅ **Можно добавить до 100 тестовых пользователей**
- ✅ **Не требует проверки Google**
- ✅ **Доступно сразу после добавления**
- ❌ **Работает только для добавленных email-адресов**

### Режим production

- ✅ **Работает для всех пользователей**
- ✅ **Не нужно добавлять пользователей вручную**
- ❌ **Требует проверки Google (может занять несколько дней)**
- ❌ **Для чувствительных scopes нужна верификация**

---

## Проверка после исправления

1. **Убедитесь, что email добавлен:**
   - Откройте OAuth Consent Screen
   - Проверьте список "Test users"
   - Ваш email должен быть там

2. **Попробуйте войти снова:**
   - Полностью закройте приложение
   - Откройте снова
   - Настройки → Резервное копирование → "Войти в Google Drive"

3. **Если ошибка сохраняется:**
   - Убедитесь, что вы используете правильный email (тот, который добавлен)
   - Попробуйте выйти из Google аккаунта на устройстве и войти снова
   - Подождите 5-10 минут после добавления email (изменения могут применяться с задержкой)

---

## Дополнительная информация

### Какие scopes запрашивает приложение:

- `https://www.googleapis.com/auth/userinfo.email` - для получения email
- `https://www.googleapis.com/auth/userinfo.profile` - для получения профиля
- `https://www.googleapis.com/auth/drive.file` - для доступа к файлам в Drive (только созданные приложением)

Все эти scopes являются **чувствительными** и требуют либо тестового режима, либо проверки Google для production.

---

## Полезные ссылки

- [Google Cloud Console - OAuth Consent Screen](https://console.cloud.google.com/apis/credentials/consent)
- [Документация OAuth 2.0 для Android](https://developers.google.com/identity/protocols/oauth2/native-app)
